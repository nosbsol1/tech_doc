
# Webサイトを表示する仕組み_補足

## なにこれ？  
Webサイトを表示する仕組みについて、長くなったので分割しました。  




#### HTTPメソッド
HTTPメソッドとは、HTTPリクエストの先頭に記載されるもので、行いたい処理をサーバーに伝える為に使われます。  
主に使われるメソッドは以下で、それぞれどういう意味かが定義されています。  

|  メソッド  |  意味  | 
|  ----  |  ----  | 
| GET | データの取得 | 
| POST | データの作成・追加、その他処理全般 | 
| PUT | データの更新・作成 | 
| DELETE | データの削除 | 

このうち特に使われるのがGET、POSTです。  
ブラウザが自動的に発行するリクエストは、GETかPOSTいずれかのメソッドになります。  
（後述しますが、URLを入力した際やリンクをクリックした際はGET、フォームデータの送信時はGETもしくはPOSTを指定できます。） 
またPOSTはデータの作成・追加が主な意味ですが、実際はどの用途でも使われています。  

PUTやDELETEは、javascriptなどにて直接HTTPリクエストを作成・送信する場合に使用されます。  


各メソッドはあくまでこういう意味で使用して下さいと定義されているだけなので、例えばGETメソッドで削除処理をするよう実装することも可能です。  
ただそうすると利用者側も実装者側も混乱するので、出来るだけメソッドと実際の処理は乖離しないようにします。  

##### 利用方法  
サーバー側がどの処理を行うか判断する為の要素の１つとして利用されます。  
例えばURLを同じにして、HTTPメソッドで処理を分けるようにサーバーを実装することがあります。  
例  
GET で情報を取る  
DELETE で情報を取る  


ただ以下のように、メソッドを同じにして、URLのパスやパラメータでどの処理を行うか判断する、とする事も出来ます。  

例
POST

どちらにするかは、分かりやすさやサーバー側の実装のしやすさなどを考慮し、設計者・実装者が判断する事です。  
あくまでどの処理を行うか判断する為の要素の１つとして利用されます。  



#### ブラウザがHTTPリクエストを送るタイミング
直接URLを入力する以外にも、ブラウザがHTTPを送信するタイミングがあります。  


- ページ上のリンクから遷移した際  
例えばyahooのニュースクリックした際などの動作です。  
リンクはhtml上はaタグで作成されています。  
クリックすると、href属性で指定されているURLをブラウザに直接入力した時と同じ動作になります。

ブラウザが送信するHTTPはGETメソッドとなり、javascriptの変数などの情報は全てクリアされます。  



- フォームデータの送信  
フォームとはhtmlのformタグで囲まれた部分の事で、画面上でユーザーに入力してもらった情報をサーバーに送信する際などに利用します。  
例えばユーザー登録画面で、顧客が入力した名前などの情報をサーバーに送る際などに利用します。  
例  



htmlのformタグの中にある`type="submit"`属性が指定されたボタンを押すと、
formタグのaction属性に指定されたURLにHTTPリクエストが送信されます。  
（フォームをサブミットするなどと言います。）    
その際のHTTPメソッドは`method`属性で指定されたものになります。
また、送られるHTTPリクエストのリクエストボディに、formタグ内のフォームコントロール要素の値が記載されます。  

例　　
<form action="http://www.foo.com" method="GET">
  <input name="say" id="say" value="Hi">
  <input name="to" id="to" value="Mom">
  <button>Send my greetings</button>
</form>


送られるリクエスト例  



サーバー側はリクエストボディの値を取り出し、登録などの処理を行うことになります。  

URLにパラメータが含まれない為、URLだけをコピーしても同じ処理は行えません。  
その為、ブックマークされ再度リクエストを送られたくないURLによく利用されます。　　
（登録、削除を行う処理のURLなど  ）



- javascriptからのリクエスト  

上の2つの場合は、ブラウザがHTTPリクエストの作成・送信とレスポンスに対する処理（Htmlの描画）を自動で行ってくれました。  
それとは別に、ブラウザに返却したJavascriptからリクエストを発行する事も出来ます。  
この場合、Httpメッセージの作成・送信やレスポンスに対する処理を自分でコーディングしなくてはいけません。  

ただし１から全て実装しなければいけないのではなく、Http通信を行うための関数が標準仕様で用意されています。   
用意されている方法は2種類あり、XMLRequestとFetchの2種類あります。  

Fetchの方が新しく、IE以外のブラウザなら対応しています。  
IEのサポートは2022/7に切れるため、それ以降はFetchが主に使われることになります。  


サーバーからのレスポンスに対してもブラウザは何もしない為、自分でどのような処理をしたいかjavascript上デコーディングする必要があります。  
（例えばサーバーから返ってきた値を画面のどこかに表示するなど）  

その関数でがHttpレスポンスを受け取ることも出来ます。  
そのレスポンスに対する処理もコードで記述する必要があります。  

例  
最初に例かく？　　

この方法でリクエストを投げた場合、ブラウザはページの再読み込みを行いません。  
その為、今のページのままで画面の一部を変更したい場合などによく利用します。  
（検索を押したら検索結果を表示している部分だけを変えるなど。）  
またjavascriptで持つ変数などもそのままになります。  

図  
gif  

また、サーバーからの戻り値はhtmlではなく、プログラムで解釈しやすり**Json**という形式のファイルを返すことが多いです。  

#### Json
プロパティ名:値 形式のフォーマットです。  

例    

javascriptのオブジェクトにそのまま変換できます。  

例  


以下、それぞれの呼び出し方の特徴をまとめました。  

|    |  HTTPメソッド  |  HTTPリクエストの送信  |  HTTPレスポンスへの対応  |    |
| ---- | ---- | ---- | ---- | ---- |
|  リンクから遷移  |  GET  | ブラウザが行う  | ブラウザが行う  |   |
|  フォームデータの送信  |  GET or POST <br>(formタグのmethod属性で指定する)  | ブラウザが行う  | ブラウザが行う  |   |
|  javascriptから送信  |  自由<br>（Httpメッセージ作成メソッドの引数で指定する。）  | javascriptでコーディング  | javascriptでコーディング  |   |


#### Webサーバーへのパラメータの渡し方
画面の入力値などのパラメータをサーバーに渡したいことがよくあります。  
（例えばユーザー登録画面で登録ボタンを押したときに、ユーザー名や住所などの情報を送りたい など） 

その際はHTTPリクエストにパラメータ情報を含めてサーバーに送ることになります。    
リクエストにパラメータを含める方法はいくつかあります。  



1. クエリストリング  
URLの末尾の`?`以降の文字列にパラメータを記載します。   
 
例  

パラメータは`キー=値`の形式で記載します。  
URLのこの部分を**クエリ文字列**といいます。

この方法はGETメソッドでリクエストする際に良く用いられます。  
formタグのmethod属性にGETが指定されていた場合、formタグ内のinputタグなどの入力値が、submit時にクエリストリングに記載されます。  

  - メリット  
  URLにパラメータ情報が含まれている為、お気に入りから再度開いた際などでも同じパラメータを渡すことが出来ます。  

  - デメリット  
  ただブラウザによってURLの文字数の最大値が決まっている為、あまり長いパラメータを渡すことは出来ません。  



1. リクエストボディにフォームデータ形式で記述  
formタグのmethod属性でPOSTを指定していた場合、formタグ内のinputタグなどの入力値が、submit時にリクエストボディに記載されます。  

例  

ボディにはキー=値形式で記載され、複数ある場合は&で連結されます。  

  - メリット  
  URLにパラメータが含まれない為、ブックマークされたURLを後で開いても同じ処理は行えません。  
  その為、登録・削除などの複数回呼ばれたくない処理や、URLに表示したくない情報（個人情報や機密情報）がある場合によく利用されます。
  また、パラメータの文字数制限もありません。  

  - デメリット  
URLにパラメータが含まれない為、ブックマークされたURLを後で開いても同じ処理は行えません。  



1. リクエストボディにフォームデータ以外の形式で記述  
javascriptなどでHttpリクエストを自分で作って発行する際は、リクエストボディにフォームデータ形式以外の形式でパラメータを含めることがあります。  
よく使われるのはjsonの文字列をリクエストボディに含める方法です。  

例  

  - メリット  
  配列やネストしたデータなどはjsonの方が表現しやすい為、プログラムからデータを送る際はこの形式で送ることが多いです。  
（json形式に変換する為のメソッドもある為、処理も簡単です。 ）

  - デメリット  
  サーバー側で再変換しやすい形式にしないとサーバー側の実装が面倒になります。  


まとめると以下になります。  

|    |  メリット  |  デメリット   |    |    |
| ---- | ---- | ---- | ---- | ---- |
|  クエリストリング  |  GET  | GET  | GET  |   |
|  リクエストボディにフォームデータ形式で記述  |  GET  | GET  | GET  |   |
|  リクエストボディにフォームデータ以外の形式で記述  |  GET  | GET  | GET  |   |

##### どの方法を使うか

ブラウザのformタグからリクエストを送る場合は①か②のいずれかの形式になります。  
javascriptからの場合はコーディング次第でどの形式でも送れます。  

どの方法でパラメータを送るかは、それぞれの方法の特性とWebページの特性を考慮して設計者・開発者が決めることです。  
（検索処理はクエリストリング、登録処理はリクエストボディに記載　など）

実装する際は、クライアント側のHtmlやjavascriptも、サーバー側のプログラムも同じ開発者が実装することが多いです。  
例えばクエリストリングで送ると決めれば、htmlやjavascirptはそのようなリクエストを送るように実装し、サーバー側はリクエストのクエリストリングからパラメータを取得するように実装することになります。  


ajax
従来型との比較

#### SPA（シングルページアプリケーション）とは  
ブラウザでリンクを遷移した場合（例えばyahooのニュースを表示した場合）やWebページをリフレッシュした際、タブの横にロード中のマークが表示され、画面が一瞬真っ白になった後画面が再描画されます。  

gif  

このような方法だと画面の表示に1秒くらい掛かってしまいます。  
余り頻繁に操作しない作業ならこれでも問題無いのですが、頻繁に操作するような画面だとこれがストレスになってしまいます。  
（例えばブラウザ版のoutlookやgmailなど。  
メールをクリックする度に画面全体が再読み込みされるとが悪くなります。）  

上でリクエストの方法の項で、javascriptでのリクエスト送信した際はページが再読み込みされないと説明しました。  
これを利用することで、ページ全体を再読み込みせずにWebページの一部を変更することが可能になります。  

ブラウザ版のoutlookやgmailでは実際にこの方法が利用されており、メールをクリックすると、画面の再読み込み無く右側にメールの本文が表示されます。  

gif

このように、画面全体を変更せずにjavascriptにて画面を変更していくWebページを、**SPA（シングルページアプリケーション）**と呼びます。  

SPAのメリットは上でも述べましたがサクサク表示出来て操作感がよいことです。  
業務アプリは頻繁に操作するものも多く、SPA形式にすることが多いです。 

デメリットとしては、実装が少し複雑になることです。  
画面のリフレッシュやURLをコピーして別タブで開かれたような場合、javascriptの変数などもクリアされてしまうので、そうした場合もちゃんとページが表示されるよう実装を工夫する必要があります。  
具体的には、historyAPIというページ遷移無しURLを変更するjavascriptの関数を利用し、ページ書き換え時にパラメータ（開いているメールのidなど）をURLに追加する事が多いです。  

ページロード時のイベントで上記パラメータを取得し、適切な処理（メールデータを取得するなど）を行います。  




#### Webアプリケーションの公開  
Webサイトを公開する際は、以下の手順を



## いろいろな呼び方
Webサイトの集合体。
例えばECサイトならマイページ、商品一覧、注文ページなど、それらを表示する為の機能をまとめたものをWebアプリケーションという。

図
各ページの図＋プログラムをWebサイトに乗せる図？


#### クライアントアプリからの呼び出し  


・MDN HTTPについての説明サイト  
https://developer.mozilla.org/ja/docs/Web/HTTP


・MDN URLとは何か  
https://developer.mozilla.org/ja/docs/Learn/Common_questions/What_is_a_URL


・サーバー
https://wa3.i-3-i.info/word144.html


・tomcat
https://wa3.i-3-i.info/word12843.html
https://thinkit.co.jp/free/article/0708/2/1
https://agency-star.co.jp/column/tomcat


・アプリケーションサーバー

https://www.otsuka-shokai.co.jp/words/application-server.html

アプリケーションサーバーにはアプリケーションプログラムによって以下のような種類がある。
（1）Java：「Tomcat」「Glass Fish」
（2）PHP：「Apache」
（3）Ruby：「Unicorn」「Thin」「Rainbows」「Puma」

マイクロソフトのIIS（Internet Information Services）はWebサーバーとアプリケーションサーバーの機能を統合しVisual Basic、C#などの言語で記述したプログラムが作動している。

Appサーバーをwebサーバーとして利用しない理由
https://qiita.com/yCroma/items/e46476e2ac7c372bb2a3

2015年Webサーバアーキテクチャ序論
https://blog.yuuk.io/entry/2015-webserver-architecture



・ブラウザ周りの仕様
https://qiita.com/megmogmog1965/items/e180d02be711cecdc038
